---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
Joshua Poirier

## Loading and preprocessing the data
If it hasn't been unzipped, unzip the *activity.zip* file from the present working directory:
```{r}
if (!file.exists("activity.csv")) {
    unzip("activity.zip")
}
```

Load the data into a data frame called *data*:
``` {r}
data <- read.csv("activity.csv", header=TRUE, nrows=17568, stringsAsFactors=FALSE)
```

Pre-process the data by formatting the *date* as a date object:
``` {r}
library(lubridate)
data$date <- ymd(data$date)
```

Show some data!
``` {r}
tail(data,3)
```

## What is mean total number of steps taken per day?
Build a new data frame from *data* that calculates the total number of steps taken on each day, and build a histogram:
``` {r}
## aggregate data on 'date' field, summing the steps for each day
dailySteps <- aggregate(x=data$steps, by=list(data$date), FUN=sum, na.rm=TRUE)
names(dailySteps) <- c("Date", "TotalSteps")

## build histogram
hist(dailySteps$TotalSteps, 
     main="Histogram of Raw Total # of Steps Taken Each Day",
     xlab="# Steps Taken Per Day",
     breaks=10)
```

Let's calculate the **mean** and **median** total number of steps taken per day:
``` {r}
meanTotalSteps <- mean(dailySteps$TotalSteps, na.rm=TRUE)
medianTotalSteps <- median(dailySteps$TotalSteps, na.rm=TRUE)
```

The mean total number of steps taken per day is **`r round(meanTotalSteps)`**; the median total number of steps taken per day is **`r round(medianTotalSteps)`**.  We show zero decimal places here as the raw data has zero decimal places, meaning zero significant digits!

## What is the average daily activity pattern?
Build a new data frame from *data* that calculates the average daily activity pattern, and call it *dailyActivity*:
``` {r avgDailyActivity}
## aggregate data on 'interval' field, finding the average steps taken for each interval
dailyActivity <- aggregate(x=data$steps, by=list(data$interval), FUN=mean, na.rm=TRUE)
names(dailyActivity) <- c("interval", "MeanSteps")
head(dailyActivity,3)
```

Let's create a time series plot of the mean steps:
``` {r}
## plot the average steps taken for each interval using default plotting system
plot(dailyActivity$interval, dailyActivity$MeanSteps, type="l", 
     main="Average Daily Activity Pattern",
     xlab="Interval (hh:mm)",
     ylab="Average Steps",
     xaxt="n")
axis(1, at=c(0,600,1200,1800,2400), labels=c("00:00", "06:00", "12:00", "18:00", "24:00"))
```

``` {r results='hide'}
rowMaxSteps <- which.max(dailyActivity$MeanSteps)
maxSteps <- dailyActivity$MeanSteps[rowMaxSteps]
maxStepsInterval <- toString(dailyActivity$interval[rowMaxSteps])
maxStepsInterval <- formatC(maxStepsInterval, width=4, format="d", flag="0")
maxStepsInterval <- paste0(substr(maxStepsInterval,1,2), ":", substr(maxStepsInterval,3,4))
```

The average daily maximum number of steps taken per 5-minute interval is **`r round(maxSteps)`**, and is taken during **interval `r maxStepsInterval`**.

## Imputing missing values
Let us calculate the total number of missing values in the dataset!
``` {r}
missingSteps <- sum(is.na(data$steps))
missingIntervals <- sum(is.na(data$interval))
missingDates <- sum(is.na(data$date))
totalMissing <- missingSteps + missingIntervals + missingDates
```

The total number of missing values in the dataset is **`r totalMissing`**.

In the previous step, we computed the average number of steps taken for each interval.  Our strategy for imputing missing values will be to insert the value from the *dailyActivity* data frame for the corresponding interval.  
``` {r message=FALSE}
library(dplyr)
## import average daily activity data frame into main data frame (linking on 'interval' field),
## then impute values from average daily activity
data <- left_join(data, dailyActivity, by="interval")
data$stepsClean <- apply(data,1,FUN=function(x) {if(is.na(x[1])) x[4] else x[1]})
print(data[2303:2311,])
```

Notice how the *stepsClean* field took the *steps* field if it was numeric, and took the *MeanSteps* field if the *steps* field was missing.  

Let's also create a clean analytic data frame for moving forward:
```{r results='hide'}
cleanData <- data.frame(date=data$date, interval=data$interval, steps=data$stepsClean)
class(cleanData$steps) <- "numeric"
```

Now let's re-build the histogram, and calculate the mean/median values to compare with our previous values.
``` {r}
## aggregate data on 'date' field, summing the steps for each day
cleanDailySteps <- aggregate(x=cleanData$steps, by=list(cleanData$date), FUN=sum, na.rm=TRUE)
names(cleanDailySteps) <- c("Date", "TotalSteps")

## build histograms
par(mfrow=c(1,2), mar=c(4,4,2,1))
hist(dailySteps$TotalSteps, 
     main="Raw Total Steps/Day",
     xlab="# Steps Taken Per Day",
     breaks=10)
hist(cleanDailySteps$TotalSteps, 
     main="Clean Total Steps/Day",
     xlab="# Steps Taken Per Day",
     breaks=10)
```

The shapes of the histograms are similar; however, the values are doubled if not more!

Now let's see how our cleaning of the data affected the mean and median values.
``` {r}
cleanMeanTotalSteps <- mean(cleanDailySteps$TotalSteps)
cleanMedianTotalSteps <- median(cleanDailySteps$TotalSteps)

diff <- matrix(c(meanTotalSteps, cleanMeanTotalSteps, medianTotalSteps, cleanMedianTotalSteps), 
               nrow=2, ncol=2, byrow=TRUE)
diff <- as.data.frame(diff)
names(diff) <- c("Raw", "Clean")
row.names(diff) <- c("Mean", "Median")
print(diff)
```

Our approach to cleaning the data has nearly tripled the mean/median number of steps taken per day!  Was this the best approach to take?  How could it be improved?  These are important questions for future work.

## Are there differences in activity patterns between weekdays and weekends?
Create a new factor variable indicating whether the record is a *weekday* (Monday-Friday), or a *weekend day* (Saturday-Sunday).  We will also split the data frame into two separate data frames: one for weekday data, and another for weekend data.

``` {r}
dayOfWeek <- weekdays(cleanData$date)
dayOfWeek <- sapply(dayOfWeek,
                   FUN=function(x) {
                       if(is.element(x, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday")))
                           as.factor("Weekday")
                       else as.factor("Weekend")
                       })
cleanData$weekday <- dayOfWeek

## split cleanData dataframe into weekday and weekend data frames - and calc averages for each interval
weekdayData <- cleanData$weekday == "Weekday"
weekendData <- cleanData$weekday == "Weekend"
weekdayData <- cleanData[weekdayData,]
weekendData <- cleanData[weekendData,]
weekdayActivity <- aggregate(x=weekdayData$steps, by=list(weekdayData$interval), FUN=mean)
names(weekdayActivity) <- c("interval", "MeanSteps")
weekendActivity <- aggregate(x=weekendData$steps, by=list(weekendData$interval), FUN=mean)
names(weekendActivity) <- c("interval", "MeanSteps")

head(cleanData,3)
```
Here is a panel plot showing the difference for the average number of steps taken throughout the day if it is a weekday, or a weekend day.
``` {r}
par(mfrow=c(2,1), mar=c(4,4,2,1))
plot(weekdayActivity$interval, weekdayActivity$MeanSteps, type="l", 
     main="Average Weekday Activity Pattern",
     xlab="Interval (hh:mm)",
     ylab="Average Steps",
     xaxt="n")
axis(1, at=c(0,600,1200,1800,2400), labels=c("00:00", "06:00", "12:00", "18:00", "24:00"))
plot(weekendActivity$interval, weekendActivity$MeanSteps, type="l", 
     main="Average Weekend Activity Pattern",
     xlab="Interval (hh:mm)",
     ylab="Average Steps",
     xaxt="n")
axis(1, at=c(0,600,1200,1800,2400), labels=c("00:00", "06:00", "12:00", "18:00", "24:00"))
```